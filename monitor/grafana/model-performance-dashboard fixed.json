{
  "title": "NexusML Model Performance (Final Full)",
  "uid": "nexusml-model-performance-final",
  "tags": ["ml", "performance", "models", "nexusml", "ops"],
  "timezone": "browser",
  "schemaVersion": 30,
  "version": 3,
  "refresh": "5s",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "editable": true,
  "panels": [
    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "title": "Sentiment Model Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 5 },
              { "color": "red", "value": 20 }
            ]
          },
          "unit": "ops"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 1 },
      "id": 2,
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_sentiment_prediction_count_total[5m])",
          "legendFormat": "Predictions/sec",
          "refId": "A"
        }
      ],
      "title": "Sentiment Predictions/sec",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.5 },
              { "color": "red", "value": 2 }
            ]
          },
          "unit": "s"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 1 },
      "id": 3,
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "histogram_quantile(0.95, rate(api_request_latency_seconds_bucket{endpoint=\"/api/sentiment/predict\"}[5m]))",
          "legendFormat": "P95 Latency (API)",
          "refId": "A"
        }
      ],
      "title": "Sentiment Latency (P95)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "max": 1,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 0.7 },
              { "color": "green", "value": 0.85 }
            ]
          },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 1 },
      "id": 4,
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(model_sentiment_confidence_score_sum[5m])) / sum(rate(model_sentiment_confidence_score_count[5m]))",
          "legendFormat": "Avg Confidence",
          "refId": "A"
        }
      ],
      "title": "Sentiment Confidence Avg",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 7 },
      "id": 5,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_sentiment_prediction_count_total[5m])",
          "legendFormat": "{{sentiment_label}}",
          "refId": "A"
        }
      ],
      "title": "Sentiment Prediction Rate by Label",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 7 },
      "id": 6,
      "options": { "legend": { "displayMode": "visible", "placement": "bottom", "showLegend": true } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "model_sentiment_confidence_score_bucket",
          "legendFormat": "Confidence {{le}}",
          "refId": "A",
          "format": "heatmap"
        }
      ],
      "title": "Sentiment Confidence Distribution",
      "type": "heatmap"
    },
    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 15 },
      "id": 7,
      "title": "Email Model Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "unit": "ops" } },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 16 },
      "id": 8,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_email_spam_detected_total[5m]) + rate(model_email_ham_detected_total[5m])",
          "legendFormat": "Total Classifications/sec",
          "refId": "A"
        }
      ],
      "title": "Email Classifications/sec",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": { "defaults": { "unit": "percent" } },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 16 },
      "id": 9,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_email_spam_detected_total[5m]) / (rate(model_email_spam_detected_total[5m]) + rate(model_email_ham_detected_total[5m])) * 100",
          "legendFormat": "Spam Rate %",
          "refId": "A"
        }
      ],
      "title": "Spam Detection Rate",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 22 },
      "id": 11,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true } },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_email_spam_detected_total[5m])",
          "legendFormat": "Spam",
          "refId": "A"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_email_ham_detected_total[5m])",
          "legendFormat": "Ham",
          "refId": "B"
        }
      ],
      "title": "Email Classification Rate",
      "type": "timeseries"
    },
    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 30 },
      "id": 12,
      "title": "RecSys Model Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": { "defaults": { "unit": "ops" } },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 31 },
      "id": 13,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_recsys_latency_seconds_count[5m])",
          "legendFormat": "Predictions/sec",
          "refId": "A"
        }
      ],
      "title": "RecSys Predictions/sec",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": { "defaults": { "unit": "percent" } },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 31 },
      "id": 14,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_recsys_cold_start_total[5m]) / rate(model_recsys_latency_seconds_count[5m]) * 100",
          "legendFormat": "Cold Start Rate %",
          "refId": "A"
        }
      ],
      "title": "RecSys Cold Start Rate",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": { "defaults": { "max": 5, "min": 1, "unit": "short" } },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 31 },
      "id": 15,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(model_recsys_predicted_rating_dist_sum[5m])) / sum(rate(model_recsys_predicted_rating_dist_count[5m]))",
          "legendFormat": "Avg Rating",
          "refId": "A"
        }
      ],
      "title": "RecSys Avg Rating",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 37 },
      "id": 16,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "model_recsys_predicted_rating_dist_bucket",
          "legendFormat": "Rating {{le}}",
          "refId": "A",
          "format": "heatmap"
        }
      ],
      "title": "RecSys Rating Distribution",
      "type": "heatmap"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 37 },
      "id": 17,
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(model_recsys_cold_start_total[5m])",
          "legendFormat": "Cold Start/sec",
          "refId": "A"
        }
      ],
      "title": "Cold Start Events",
      "type": "timeseries"
    },
    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 46 },
      "id": 18,
      "title": "Operational Metrics (Load & Batch)",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "color": { "mode": "palette-classic" }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 47 },
      "id": 19,
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "model_load_duration_seconds",
          "legendFormat": "{{model_type}}",
          "refId": "A"
        }
      ],
      "title": "Model Load Time (Startup Latency)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": { "drawStyle": "bars" }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 47 },
      "id": 20,
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "rate(batch_processing_size_records_sum[5m])",
          "legendFormat": "{{model_type}} Records Processed/sec",
          "refId": "A"
        }
      ],
      "title": "Batch Throughput (Records per Second)",
      "type": "timeseries"
    }
  ],
  "templating": {
    "list": [
      {
        "current": { "selected": false, "text": "Prometheus", "value": "prometheus" },
        "hide": 0,
        "includeAll": false,
        "label": "Datasource",
        "multi": false,
        "name": "datasource",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      }
    ]
  }
}