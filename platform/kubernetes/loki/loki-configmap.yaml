apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-configmap
  namespace: nexusml # Assuming a namespace for the project
data:
  local-config.yaml: |
    auth_enabled: false

    server:
      http_listen_port: 3100
      grpc_listen_port: 9095

    common:
      ring:
        instance_addr: 127.0.0.1
        kvstore:
          store: inmemory
      replication_factor: 1
      path_prefix: /loki # Corrected path to match volume mount

    schema_config:
      configs:
        - from: 2020-10-24 # Using an earlier date for schema compatibility
          store: boltdb-shipper
          object_store: filesystem
          schema: v11 # Using a common schema version
          index:
            prefix: index_
            period: 24h

    storage:
      filesystem:
        mount_enabled: true
        directory: /loki # Corrected directory to match volume mount

    # Note: scrape_configs are for Prometheus, not Loki. Loki receives logs.
    # If you want to configure log forwarding from other services to Loki,
    # you would typically use Promtail or Fluentd/Fluent Bit as agents.
